<html>
<head>
</head>
<body>
<script type="text/javascript">
var WEEKLY = 24 * 7;
var HOURLY = 1;

/**
 * TODO: implement
 *
 * 	port.postMessage({filtereTagChanged: tagFilter});
 *	port.postMessage({filtereTagDeleted: tagFilter});
 *	port.postMessage({filtereTagAdded: tagFilter});
 *
 */
 
chrome.extension.onConnect.addListener(function(port) {
	  console.assert(port.name == "social-media-monitoring");
	  port.onMessage.addListener(function(msg) {
	    if (msg.filterTagChanged) {
			var filterTag = msg.filterTagChanged;
			loadTweets(WEEKLY, filterTag);
			loadTweets(HOURLY, filterTag);
	    }
	  });
	});

function setItem(key, value) {
	try {
		console.log('Set Item:' + key);
		window.localStorage.removeItem(key);
		window.localStorage.setItem(key, value);
	}catch(e) {
		console.log("Error writing item to localstorage for key: " + key + " value: " + value);
		console.log(e);
	}
}

function getItem(key) {
	var value;
	console.log('Get Item:' + key);
	try {
		value = window.localStorage.getItem(key);
	}catch(e) {
	console.log("Error getting item to localstorage for key:" + key);
	 	 console.log(e);
	  	value = null;
}

function loadTweets(period, filterTag) {
	var req = new XMLHttpRequest();
	req.open(
		"GET",
	    "http://search.twitter.com/search.json?" + "q="+escape(filterTag.id),
	    true);
	req.onload = function() {
		processResult(period);
	};
 	req.send(null);
}

function processResult(period) {
	console.log("processResults");
	  var tweets = JSON.parse(req.responseText).results;
	  var currTime = Date();
	  var interval = period * 60 * 60 *1000;
	  for (var i = 0, tweets < tweets.length; i++) {
		var currDate = new Date(results.created_at);
		var ts = currDate.getTime();

		if
		
    	var text = document.createElement("span");
	    img.innerHTML = result.created_at
	    document.body.appendChild(text);
	  }
}

</script>

</body>
</html>


